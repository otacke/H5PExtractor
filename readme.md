# H5P Extractor - proof of concept
Tool that is supposed to be be usable for rendering H5P content server-side.

## VERY IMPORTANT NOTE
Currently, the dependency to h5p-core is pinned to version ~1.24. That's because
the H5P plugin for WordPress still uses an older core API that could break
when using this library. The main target system for this library is WordPress
though. If you are planning to use this library alongside H5P via composer,
you may need to change the dependency version requirement or otherwise your
platform may not be able to run the H5P plugin properly. I still need to figure
out if there is a way to make the dependency version "flexible".

## Quick start (to be done properly (!))
1. Copy the library to your ow project. You can also use composer, but you will
   need to fetch the library from github, because it is not available via packagist
   (yet).

   Your `composer.json` file should contain
   ```
   "repositories": [
        {
            "type": "vcs",
            "url": "https://github.com/otacke/H5PExtractor"
        }
    ],
    "require": {
        "snordian/h5p-extractor": "dev-master"
   }
   ```
   and any other of your dependencies, of course.

2. Use `require_once <path_to_h5p-extractor> . '/app/H5PExtractor.php';` to
load code. It does autload everything it needs, but it is not instantiated by
any autoload itself, because it it seems appropriate to only load H5PExtractor
once actually needed.

3. Use `$h5pExtractor = new H5PExtractor\H5PExtractor($config);` to create an
   instance, where `$config` is supposed to be an optional an associative array
   containing configuration items, e.g.:
   ```
   $config = [
     'uploadsPath' => <path to be used for uploads relative to h5p-extractor : string>
     'renderWidth' => <the assumed viewport width : number, default: 1024>
     'target' => <specific target as option : ['print|screen'], default: 'print'>
     'scope' => <specific scope as option : ['all|initial'], default: 'all'>
   ]
   ```

   By default, if that value is not set or no `$config` argument is passed,
   H5PExtractor will try to create/use a directory named `uploads` inside its main
   `h5p-extractor` directory.

   Please ensure that the respective `uploads` directory can be read and written by
   your server process.

4. Use something like
   ```
   $extract = $h5pExtractor->extract(
       [
           'file' => $file['tmp_name'],
           'format' => $_POST['format']
       ]
   );
   ```
   where
   - `file` is supposed to be the H5P file that contains the H5P content that is
     supposed to be rendered - here a standard temporary file generated by a
     form upload.
   - `format` specifies the desired output format (currently `html` (default) or
    `text`) - here the `format` key of the form upload.

   The return value is an associative array with the key `result` or `error`.
   - `result` contains the requested output format
   - `error` contains an error message if something went wrong.

## Creating/changing generators
A generator is what creates a distinct output format from an H5P content. It
will commonly be HTML or some plain text variant, but could be something
different, too.

The generation process resembles how the H5P core composes H5P content from
different content types, and methods such as `newRunnable` or `attach` were 
called that way because they have direct counterparts in H5P core/a content
type. They also use the same arguments, even though they're not all required
here. If you know `newRunnable` or `attach`, then you already know what they
do here. And if you don't and learn what they do here, you learn something
about H5P core and H5P content types as a side product :-)

### TODO: Explain Structure
### TODO: Explain Generator
### TODO: Explain GeneratorInterface

### Open issues:
- Implement handling of target and scope where needed
- Add option to display answers for questions
